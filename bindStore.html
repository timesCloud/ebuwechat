<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
    <title>商铺绑定</title>
    <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>

    <script src="js/mobiscroll_002.js" type="text/javascript"></script>
    <script src="js/mobiscroll_004.js" type="text/javascript"></script>
    <link href="css/mobiscroll_002.css" rel="stylesheet" type="text/css">
    <link href="css/mobiscroll.css" rel="stylesheet" type="text/css">
    <script src="js/mobiscroll.js" type="text/javascript"></script>
    <script src="js/mobiscroll_003.js" type="text/javascript"></script>
    <script src="js/mobiscroll_005.js" type="text/javascript"></script>
    <link href="css/mobiscroll_003.css" rel="stylesheet" type="text/css">

    <script src="https://cdn1.lncld.net/static/js/av-mini-0.5.7.js"></script>
<!--    <script>
        AV.initialize("efqmjf2gco3z0b9eqlvx714kfvzfpkx94mrr4xbbi7pzu4ts", "9xu5smmtkpnvz6h3k8r82dn6kfims9d8hpg2je5tztmot4wf");
    </script>-->
    <script>
        AV.initialize('56fN6rijVJvWJo6EMTwcoMLs', 'Fl3vxu3ssxOHmnJARKqELp0m');
    </script>
    <style type="text/css" rel="stylesheet">
        *{margin:0;padding:0;}body{background-color: #efeff4;font-size: 16px;}img{border:none}
        li{list-style-type: none}

        .noStore{width:90%;height:200px;margin:80px 0 0 5%;padding-top:10px;text-align:center;
            background-color: #fff;border-radius: 3px;}
        .noStore button{height:50px;padding:0 10px;margin:50px 30px;font-size: 16px;background-color:#7eb506;
            border:none;border-radius: 3px;color:#fff }
        .noStore p{margin-top: 30px;font-weight: 700}

        .invitation_store{width:90%;height:200px;margin:80px 0 0 5%;padding-top:10px;text-align:center;
            background-color: #fff;border-radius: 3px;}
        .invitation_store li{width:94%;height:50px;margin: 20px 0;padding:5px 3%}
        .invitation_store li label{display:inline-block;height: 35px;
            width:35%;line-height: 35px;}
        .invitation_store li button{width:35%;height:35px;background-color:#7eb506 ;color:#fff;font-size: 16px;
            border:none;border-radius: 2px;}
        .invitation_store li input{margin-left:2%;width:55%;border:solid 1px #cfcfcf;
            height: 35px;border-radius: 4px;}

        .first{padding:10px 20px;border-bottom: 1px solid #d3d2d2;}
        .first label{margin-bottom: 5px;display:inline-block}
        .storeMes .first input{color:#333333;height:36px;width:96%;font-size: 14px;border-radius: 3px;
            border:solid #d3d2d2 1px;}
        .invitationCode{background-color: #7eb506;padding:5px;margin-bottom: 3px;border-radius: 2px;color:#FFF;border:none}
        .submit{font-size:16px;width:96%;border-radius: 3px;
            background: -webkit-linear-gradient(#7eb506, #4e8200);
            background: -moz-linear-gradient(#7eb506, #4e8200);
            border-style:none; padding:15px;margin:2em 2%;color:#ffffff}
        .cover{height: 100%;width: 100%;position: fixed;z-index:999;top:0;background-color: rgba(0,0,0,0.5);}
        .chooseType,.chooseCity,.time_choose{position:fixed;top:0;left:0;background-color: rgba(0,0,0,0.5);z-index: 99;width:100%;height:100%}
        .chooseType ul,.chooseCity ul{background-color: #fff;width:60%;text-indent:1em;border-radius: 5px}
        .chooseType ul li:first-child,.chooseCity ul li:first-child{border-bottom:1px solid #ECF0F1}
        .chooseType ul li,.chooseCity ul li{padding:15px 0;}
        .chooseType ul{margin:25% 0 0 20%}
        .chooseCity ul{margin: 30% 0 0 20%}

        .timePicker{text-align: center;border-radius:5px;position:relative;width:100%;margin:20% 20%;padding:2% 0;background-color: red}
        .ulOne{width:90%;margin-left: 5%;}
        .ulOne h1{width:100%;height:2em;line-height:2em;border-bottom:1px solid #ECF0F1; font-size: 15px;font-weight:100;color:#4e8200}
        .ulOne li:last-child{font-size: 12px;color: #fe6905}
        .ulTwo{width:90%;margin-left: 5%;color:#4e8200;overflow: hidden}
        .ulTwo li:first-child{margin-left:20%;float:left;width:20%}
        .ulTwo li:last-child{margin-right:20%;float:right;width:20%}
        .addNumH,.addNumM{display:block;padding:5px 0}
        #h,#m{color:#4e8200;text-align:center;}
        .subtractNumH,.subtractNumM{display:block;padding:5px 0}
        .ulThree{width:90%;margin:3% 0 0 5%;overflow: hidden}
        .confirm{font-size:12px;color:white;border-radius:3px;margin-left:9%;background-color: #4e8200;float:left;width:40%;height:2em;line-height: 2em}
        .cancel{font-size:12px;color:white;border-radius:3px;margin-right:9%;background-color: #4e8200;float:right;width:40%;height:2em;line-height: 2em}

    </style>
</head>
<body>
<section id="noBindStore" hidden="hidden" >
    <div class="noStore">
        <p>您没有绑定商铺</p>
        <button class="joinStore" onclick="invitationJoin()">添加用户</button>
        <button class="createStore" onclick="createStore()">创建店铺</button>
    </div>
</section>
<section id="invitationStore" hidden="hidden">
    <ul class="invitation_store">
        <li><label>用户手机号:</label><input type="tel" placeholder="用户手机号" /></li>
        <li>
            <button onclick="checkUser()">检测用户</button><input type="text" id="showUserMessage" placeholder="暂无检测信息" disabled="disabled"/>
        </li>
    </ul>
</section>
<section id="storeMessage" >
    <div style="background-color: #fff">
        <ul class="storeMes">
            <li class="first"><label>店铺名称</label><input type="text" placeholder="店铺名称：" /></li>
            <li class="first"><label>店铺类型</label><div id="chooseType"></div><input onclick="chooseType()" readonly="readonly" placeholder="店铺类型："/></li>
            <li class="first"><label>店铺地址</label><input type="text" placeholder="店铺地址："/></li>
            <li class="first"><label>所在城市</label><div id="chooseCity"></div><input onclick="chooseCity()" readonly="readonly" placeholder="所在城市："/></li>
            <li class="first"><label>联系人姓名</label><input type="text" placeholder="联系人姓名："/></li>
            <li class="first"><label>联系电话</label><input type="tel" placeholder="联系电话："/></li>
            <li class="first">
                <label for="appTimeEarly">最早收货时间</label><input onchange="earlyGetTO(this)" value="9:15" class="" readonly="readonly" name="appTime" id="appTimeEarly" placeholder="最早收货时间">
            </li>
            <li class="first">
                <label for="appTimeLate">最晚收货时间</label><input onchange="lateGetTO(this)" value="9:15" class="" readonly="readonly" name="appTime" id="appTimeLate" placeholder="最晚收货时间">
            </li>

<!--
            <li class="first"><label>最早收货时间</label><input onclick="earlyTime()" readonly="readonly" placeholder="最早收货时间："/></li>
            <div id="timeChoose"></div>
            <li class="first"><label>最晚收货时间</label><div id="lastTime"></div><input onclick="lastTime()" readonly="readonly" placeholder="最晚收货时间："/></li>
-->

            <li class="first salesManCode"><label>业务员手机号</label><input type="tel" placeholder="业务员手机号："/></li>
            <li class="first salesManCode">
                <button class="invitationCode" onclick="getInvitationCode()">获取邀请码</button>
                <button class="invitationCode" hidden="hidden"></button>
                <input type="tel" placeholder="邀请码："/>
            </li>
        </ul>
    </div>
    <button onclick="insertStore()" type="button" class="submit">提交信息</button>
</section>
<div class='cover' style="display:none">
    <div style="margin:45% 35%;height: 80px;width: 80px;">
        <img src="images/loading02.gif" style="margin-left:15px;border-radius: 5px"/>
        <h5 style="color:#fff;text-align: center">店铺检测中</h5>
    </div>
</div>

<script type="text/javascript">
var GVEarlyTime,earlyTimeArr=[];
var GVLastTime,lastTimeArr=[];
var currentCityObj,currentCityId;
var currentUserObj=AV.User.current();
var userObj;
var currentLatitude=30.573545,currentLongitude=104.004378;
var t=0;
var sType,storeTypeId;
var storeObj;
var bindOrEdit='bind',checkOrAdd='check';
var setTime;
var jurisdiction=false;

function earlyGetTO(t){
    var timeStr=t.value;
    var timeH=timeStr.substr(0,1);
    var timeM=timeStr.substr(3,1);
    if(timeH==0){
        earlyTimeArr[0]=timeStr.substr(1,1);
    }else{
        earlyTimeArr[0]=timeStr.substr(0,2);
    }
    if(timeM==0){
        earlyTimeArr[1]=timeStr.substr(4,1);
    }else{
        earlyTimeArr[1]=timeStr.substr(3,2);
    }
    GVEarlyTime=new Date(2015,10,1,earlyTimeArr[0],earlyTimeArr[1],0);
}
function lateGetTO(t){
    var timeStr=t.value;
    var timeH=timeStr.substr(0,1);
    var timeM=timeStr.substr(3,1);
    if(timeH==0){
        lastTimeArr[0]=timeStr.substr(1,1);
    }else{
        lastTimeArr[0]=timeStr.substr(0,2);
    }
    if(timeM==0){
        lastTimeArr[1]=timeStr.substr(4,1);
    }else{
        lastTimeArr[1]=timeStr.substr(3,2);
    }
    GVLastTime=new Date(2015,10,1,lastTimeArr[0],lastTimeArr[1],0);
}
$(function () {
    var currYear = (new Date()).getFullYear();
    var opt={};
    opt.date = {preset : 'date'};
    opt.datetime = {preset : 'datetime'};
    opt.time = {preset : 'time'};
    opt.default = {
        theme: 'android-ics light', //皮肤样式
        display: 'modal', //显示方式
        mode: 'scroller', //日期选择模式
        dateFormat: 'yyyy-mm-dd',
        lang: 'zh',
        showNow: true,
        //nowText: "今天",
        startYear: currYear - 10, //开始年份
        endYear: currYear + 10 //结束年份
    };

    //$("#appDate").mobiscroll($.extend(opt['date'], opt['default']));
    //var optDateTime = $.extend(opt['datetime'], opt['default']);
    var optTime = $.extend(opt['time'], opt['default']);
    //$("#appDateTime").mobiscroll(optDateTime).datetime(optDateTime);
    $("#appTimeEarly").mobiscroll(optTime).time(optTime);
    $("#appTimeLate").mobiscroll(optTime).time(optTime);
});
//获取业务员邀请码
function getInvitationCode(){
    var phoneNum=document.querySelectorAll('#storeMessage input')[8].value;
    var buttonCode=document.getElementsByClassName('invitationCode');
   if(phoneNum!=''){
        AV.Cloud.run('GetOrangeCode',
                {
                    mobilePhoneNo:phoneNum
                },
                {
                    success:function(r){
                        alert(r);
                        t=31;
                        buttonCode[0].setAttribute('hidden','hidden');
                        buttonCode[1].removeAttribute('hidden');
                        codeTimer();
                    },
                    error:function(e){
                        alert(e.message+'kk');
                    }
                }
        );
    }else{
        alert('请填写可接收邀请码的业务员手机号！');
    }
    //获取验证码计时
    function codeTimer(){
        t--;
        var clearCT=setTimeout(codeTimer,1000);
        if(t<=0){
            clearTimeout(clearCT);
            buttonCode[1].setAttribute('hidden','hidden');
            buttonCode[0].removeAttribute('hidden');
        }
        buttonCode[1].innerHTML=t+'秒后重试';
    }
}
//检测用户
function checkUser(){
    var phoneNum=document.querySelectorAll('#invitationStore input')[0].value;
    if(checkOrAdd=='check'){
        if(phoneNum!=''){
            var queryUser=new AV.Query(AV.User);
            queryUser.equalTo('username',phoneNum);
            queryUser.find({
                success:function(r){
                    if(r.length>0){
                        userObj=r[0];
                        var userMessage=r[0].get('nickname')+':'+r[0].get('username');
                        $('#showUserMessage').prev().text('添加此用户');
                        $('#showUserMessage').val(userMessage);
                        checkOrAdd='Add';
                    }
                }
            });
        }else{
            alert('请填写用户手机号！');
        }
    }
    if(checkOrAdd=='Add'){
        getStore();
    }
}
//获取当前用户餐厅
function getStore(){
    var tableStore=AV.Object.extend('Store');
    var queryStore=new AV.Query(tableStore);
    queryStore.include('owner');
    queryStore.equalTo('owner',currentUserObj);
    queryStore.find({
        success:function(r){
            var UserJoinStore=AV.Object.extend('UserJoinStore');
            var ujs=new UserJoinStore();
            ujs.set('user',userObj);
            ujs.set('store',r[0]);
            ujs.set('owner',false);
            ujs.save(null,{
                success:function(r){
                    alert('申请加入成功！');
                },
                error:function(obj,e){
                    alert('申请加入失败:'+ e.message);
                }
            });
        },
        error:function(e){
            alert('查询当前店铺失败:'+e.message);
        }
    });
}
//选择餐厅类型
function chooseType(){
    var storeType;
    var chooseTObj=document.getElementById('chooseType');
    chooseTObj.innerHTML='<div class="chooseType"><ul><li>餐厅</li><li>超市</li></ul><div>';
    $('.chooseType li').click(function(){
        storeType=$(this).text();
        $(this).parents('#chooseType').next().val(storeType);
        chooseTObj.innerHTML='';
        getTypeObj(storeType);
    });
    //得到要保存的店铺类型
    function getTypeObj(storeType){
        var tableStoreType=AV.Object.extend('StoreType');
        var queryStoreType=new AV.Query(tableStoreType);
        queryStoreType.equalTo('typeName',storeType);
        queryStoreType.find({
            success:function(r){
                storeTypeId=r[0].id;
                sType=r[0];
            },
            error:function(obj,e){
                alert(e.message);
            }
        });
    }
}
//获取经纬度
function getPosition(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
                function (p){
                    currentLatitude=p.coords.latitude;
                    currentLongitude=p.coords.longitude;
                },
                function ( e ) {
                    alert( "GeoLocation error: " + e.message );
                }
        );
    }else{
        alert('不支持获取经纬度！');
    }
}
function chooseCity(){
    var cityName;
    var chooseTObj=document.getElementById('chooseCity');
    chooseTObj.innerHTML='<div class="chooseCity"><ul><li>成都</li><li>重庆</li></ul><div>';
    $('.chooseCity li').click(function(){
        cityName=$(this).text();
        $(this).parents('#chooseCity').next().val(cityName);
        chooseTObj.innerHTML='';
        getCityObj(cityName);
    });
    //得到要保存的City对象
    function getCityObj(cityName){
        var tableCity=AV.Object.extend('City');
        var queryCity=new AV.Query(tableCity);
        queryCity.equalTo('cityName',cityName);
        queryCity.find({
            success:function(r){
                 currentCityObj=r[0];
                 currentCityId=r[0].id;
            },
            error:function(obj,err){
                alert('发生错误，请刷新！');
            }
        });
    }
}
//时间选择器
function timePicker(earlyOrLast){
    var hour,minute;
    $('.addNumH').click(function(){hour=parseInt($('#h').text());if(hour<23){hour=hour+1;$('#h').text(hour);$('#hour').text(hour);}});
    $('.subtractNumH').click(function(){hour=parseInt($('#h').text());if(hour>1){hour=hour-1;$('#h').text(hour);$('#hour').text(hour);}});
    $('.addNumM').click(function(){minute=parseInt($('#m').text());if(minute<50){minute=minute+10;$('#m').text(minute);$('#minute').text(minute);}});
    $('.subtractNumM').click(function(){minute=parseInt($('#m').text());if(minute>0){minute=minute-10;$('#m').text(minute);$('#minute').text(minute);}});
    $('.confirm').click(function(){hour=$('#h').text();minute=$('#m').text();getTimeObj(hour,minute,earlyOrLast);$('#timeChoose').html('')});
    $('.cancel').click(function(){hour=$('#h').text();minute=$('#m').text();getTimeObj(hour,minute,earlyOrLast);$('#timeChoose').html('')});
}
//获取选择时间对象
function getTimeObj(h,m,EOL){
    var myDate = new Date(2015,10,1,h,m,0);
    var timeArr=[];
    var inputObj=document.querySelectorAll("#storeMessage input");
    h=parseInt(h);m=parseInt(m);
    timeArr[0]=h;
    timeArr[1]=m;
    if(EOL=='eT'){
        earlyTimeArr=timeArr;
        GVEarlyTime=myDate;
        inputObj[6].value='最早收货时间：'+timeArr[0]+':'+timeArr[1]+':'+'00';
    }
    if(EOL=='lT'){
        lastTimeArr=timeArr;
        GVLastTime=myDate;
        inputObj[7].value='最晚收货时间：'+timeArr[0]+':'+timeArr[1]+':'+'00';
    }
}
function insertTimePic(){
    $('#timeChoose')[0].innerHTML='<div class="time_choose"><div class="timePicker">'+
            '<ul class="ulOne"><li><h1>时间选择</h1></li><li><span id="hour">9</span>时<span id="minute">30</span>分</li></ul>'+
            '<ul class="ulTwo"><li> <span class="addNumH">'+'+'+'</span><span id="h">9</span><span class="subtractNumH">'+'-'+'</span></li><li><span class="addNumM">'+'+'+'</span><span id="m">30</span><span class="subtractNumM">'+'-'+'</span></li></ul>'+
            '<ul class="ulThree"><li class="confirm">确定</li><li class="cancel">取消</li></ul>'+
            '</div></div>';
}
function earlyTime(){
    insertTimePic();
    timePicker('eT');
}
function lastTime(){
    insertTimePic();
    timePicker('lT');
}
//标准化显示时间
function getTime(objTime){
    var hour=objTime.getHours();
    if(hour<10) hour='0'+hour;
    var minute=objTime.getMinutes();
    if(minute<10) minute='0'+minute;
    var reTime=hour+':'+minute+':'+'00';
    return reTime;
}
function timer(){
    t++;
    if(t==10){
        clearTimeout(setTime);
        alert('绑定失败，请重试！');
        location.reload();
    }else{
        setTime=setTimeout(timer,1000);
    }
}
//申请加入
function invitationJoin(){
    if(jurisdiction){
        document.getElementById('noBindStore').setAttribute('hidden','hidden');
        document.getElementById('invitationStore').removeAttribute('hidden');
    }else{
        alert('对不起，您没有权限！');
    }

}
//创建店铺
function createStore(){
    document.getElementById('noBindStore').setAttribute('hidden','hidden');
    document.getElementById('storeMessage').removeAttribute('hidden');
}
//查询UserJoinStore表,检测店铺是否存在
function selectUserJoinStore(){
    document.getElementsByClassName('cover')[0].style.display='block';
    var UserJoinStore=AV.Object.extend('UserJoinStore');
    var queryUJS=new AV.Query(UserJoinStore);
    queryUJS.equalTo('user',currentUserObj);
    queryUJS.ascending('createdAt');
    queryUJS.include('store');
    queryUJS.find({
        success:function(r){
            if(r.length>0){
                document.getElementsByClassName('cover')[0].style.display='none';
                document.getElementsByClassName('submit')[0].innerHTML='编辑信息';
                bindOrEdit='edit';
                $('#noBindStore p').text('您已绑定商铺');
                $('#noBindStore button')[1].innerHTML='编辑信息';
                if(r[0].get('owner')!=true){
                    $("#storeMessage input").attr('disabled','disabled');
                    document.getElementsByClassName('submit')[0].style.display='none';
                }
                if(r[0].get('owner')==true){
                    jurisdiction=true;
                }
                $(".salesManCode").attr('hidden','hidden');
                selectTableStore(r[0].get('store').id);
            }else{
                document.getElementsByClassName('cover')[0].style.display='none';
                document.getElementById('noBindStore').removeAttribute('hidden');
            }
        },
        error: function (e) {
            document.getElementsByClassName('cover')[0].style.display='none';
            alert('查询餐厅失败:'+e.message);
        }
    });
}
//编辑数据
function editStoreMessage(Store,storeName,storeAddress,contactName,storeContact){
    timer();
    var currentPosition=new AV.GeoPoint({latitude:currentLatitude,longitude:currentLongitude});
    var queryStore=new AV.Query(Store);
    queryStore.include('owner');
    queryStore.equalTo('owner',currentUserObj);
    queryStore.find({
        success:function(r){
            queryStore.get(r[0].id,{
                success:function(re){
                    re.set('earlyTime',GVEarlyTime);
                    re.set('latestTime',GVLastTime);
                    re.set('storeName',storeName);
                    re.set('storeAddress',storeAddress);
                    re.set('contactName',contactName);
                    re.set('storeContact',parseInt(storeContact));
                    re.set('city',currentCityObj);
                    re.set('owner',currentUserObj);
                    re.set('storePosition',currentPosition);
                    re.set('storeType',sType);
                    re.save({
                        success:function(){
                            alert('修改成功');
                            location.reload();
                        },
                        error:function(obj,e){
                            alert(e.message+'修改失败,请重试！');
                            location.reload();
                        }
                    });
                },
                error:function(obj,er){
                    alert(e.message);
                }
            });
        },
        error:function(obj,e){
            alert(e.message);
        }
    });
}
//数据绑定
function bindStore(mobilePhoneNo,orangeCode,storeName,storeContact,contactName,storeAddress){
   timer();
  // console.log(mobilePhoneNo+'--'+orangeCode+'--'+storeName+'--'+currentLatitude+'--'+currentLongitude+'--'+storeContact+'--'+contactName+'--'+storeAddress+'--'+earlyTimeArr+'--'+lastTimeArr+'--'+currentCityId+'--'+storeTypeId);
   AV.Cloud.run('AddStore',
         {
             'mobilePhoneNo':mobilePhoneNo,
             'orangeCode':orangeCode,
             'storeName':storeName,
             'storePosition':{
             "__type": "GeoPoint",
             "latitude": currentLatitude,
             "longitude": currentLongitude
             },
             'storeContact':storeContact,
             'contactName':contactName,
             'ownerOid':currentUserObj.id,
             'storeAddress':storeAddress,
             'earlyHour':earlyTimeArr[0],
             'earlyMinute':earlyTimeArr[1],
             'latestHour':lastTimeArr[0],
             'latestMinute':lastTimeArr[1],
             'cityOid':currentCityId,
             'storeTypeOid':storeTypeId
         },
         {
             success:function(r){
                 alert(r);
                 document.getElementsByClassName('cover')[0].style.display='none';
                 location.reload();
             },
             error:function(e){
                 alert(e);
                 document.getElementsByClassName('cover')[0].style.display='none';
                 location.reload();
             }
         }
     );
}
//显示数据
function selectTableStore(storeId){
    var Store=AV.Object.extend('Store');
    var queryTableStore=new AV.Query(Store);
    queryTableStore.equalTo('objectId',storeId);
    queryTableStore.include('storeType');
    queryTableStore.include('city');
    queryTableStore.find({
        success:function(r){
            GVEarlyTime=r[0].get('earlyTime')||'';
            GVLastTime=r[0].get('latestTime')||'';
            currentCityObj=r[0].get('city')==null?'':r[0].get('city');
            sType=r[0].get('storeType')||'';
            var inputArr=[];
            inputArr[0]=r[0].get('storeName')||'';
            inputArr[1]=r[0].get('storeType')==null?'':r[0].get('storeType').get('typeName');
            inputArr[2]=r[0].get('storeAddress');
            inputArr[3]=currentCityObj==''?'':currentCityObj.get('cityName');
            inputArr[4]=r[0].get('contactName')||'';
            inputArr[5]=r[0].get('storeContact')||'';
            inputArr[6]=getTime(GVEarlyTime);
            inputArr[7]=getTime(GVLastTime);
            var storeMessageInputObj=document.querySelectorAll("#storeMessage input");
            for(var i=0;i<8;i++){
                storeMessageInputObj[i].value=inputArr[i];
            }
        },
        error:function(obj,e){
            alert(e.message);
        }
    });
    function getTime(objTime){
        //标准化显示时间
        var hour=objTime.getHours();
        if(hour<10) hour='0'+hour;
        var minute=objTime.getMinutes();
        if(minute<10) minute='0'+minute;
        var reTime=hour+':'+minute;
        return reTime;
    }
}
//判断绑定还是编辑
function insertStore(){
    var inputArr=[];
    var storeMessageInputObj=document.querySelectorAll("#storeMessage input");
    for(var i=0;i<10;i++){
        inputArr[i]=storeMessageInputObj[i].value;
    }
    var storeName=inputArr[0];
    var storeAddress=inputArr[2];
    var contactName=inputArr[4];
    var storeContact=inputArr[5];
    var mobilePhoneNo=inputArr[8];
    var orangeCode=inputArr[9];
    var Store=AV.Object.extend('Store');
    var bindStr=storeName&&storeAddress&&contactName&&storeContact&&mobilePhoneNo&&orangeCode&&currentLatitude&&currentLongitude&&currentUserObj&&storeTypeId&&currentCityId&&earlyTimeArr[1]&&lastTimeArr[1];
    //console.log(storeName+'--'+storeAddress+'--'+contactName+'--'+storeContact+'--'+mobilePhoneNo+'--'+orangeCode+'--'+currentLatitude+'--'+currentLongitude+'--'+currentUserObj+'--'+storeTypeId+'--'+currentCityId+'--'+earlyTimeArr[1]+'--'+lastTimeArr[1]);
    var editStr=storeName&&storeAddress&&contactName&&storeContact&&currentLatitude&&currentLongitude&&currentUserObj&&GVEarlyTime&&GVLastTime&&currentCityObj&&currentUserObj&&sType;
    //console.log(Store+'--'+storeName+'--'+storeAddress+'--'+contactName+'--'+storeContact+'--'+currentLatitude+'--'+currentLongitude);
    //console.log(currentUserObj+'--'+GVEarlyTime+'--'+GVLastTime+'--'+currentCityObj+'--'+currentUserObj+'--'+sType);
    if(bindOrEdit=='bind'&&bindStr){
             document.getElementsByClassName('cover')[0].style.display='block';
             document.querySelector('h5').innerHTML='提交信息中';
             bindStore(mobilePhoneNo,orangeCode,storeName,storeContact,contactName,storeAddress);
    }
    if(bindOrEdit=='edit'&&editStr){
         document.getElementsByClassName('cover')[0].style.display='block';
         document.querySelector('h5').innerHTML='提交修改中';
         editStoreMessage(Store,storeName,storeAddress,contactName,storeContact);
    }
}
//开始执行
//getPosition();
//selectUserJoinStore();
</script>
</body>
</html>